<!--
  locals: {
    user,
    loggedIn,
    userScores
  }
-->

<%- include('../partials/header.ejs', { loggedIn }) %>
  <div class="container text-center">
    <div class="my-2 mx-auto">
      <img src="<%= user.img_url %>" alt="profile image" class="img-fluid img-thumbnail" width="128" />
    </div>

    <div class="row">
      <div class="col-sm-12">
        <h1 class="display-4">
          <%= user.name %>
        </h1>
        <p>
          <%= user.email %>
        </p>
      </div>
    </div>

    <% if(user.bio) { %>
    <p><%= user.bio %></p>
    <% } %>

    <% if(user.address.city) { %>
    <p class="fw-bold"><%= user.address.city %>
    <% } %>
    <% if(user.address.state) { %>
    , <%= user.address.state %>
    <% } %>
    </p>

  </div>

  <ul class="nav justify-content-center">
    <li class="nav-item">
      <a href="/users/profile/update" class="nav-link">Update Profile</a>
    </li>
  </ul>

  <div class="container">

    <% if(userScores.length==0) { %>
      <p>You do not have any assessments. Click <a href="/">here</a> to find one...</p>
      <% } else { %>

        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Assessment Name</th>
              <th>Module Name</th>
              <th>Module Score</th>
              <th>Date Taken</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            <% userScores.map((userScore)=> { %>
              <% userScore.module_scores.map(moduleScore=> { %>
                <tr>
                  <td>
                    <%= userScore.assessment_key %>
                  </td>
                  <td>
                    <%= moduleScore.name %>
                  </td>
                  <td>
                    <%= moduleScore.score %>
                  </td>
                  <td>
                    <%= userScore.date.toLocaleDateString('en-US') %>
                  </td>
                  <td>
                    <%= userScore.status %>
                  </td>
                  <td></td>
                </tr>
                <% }) %>
                  <% }) %>
          </tbody>
        </table>

        <!-- End else -->
        <% } %>
  </div>

  <script>
    console.log("Signed in with: <%= user.provider.name %>");
  </script>
  <%- include('../partials/footer.ejs') %>